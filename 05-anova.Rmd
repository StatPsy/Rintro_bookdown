---
output:
  pdf_document: default
  html_document: default
---

# ANOVA à mesures répétées

## ANOVA à mesures répétées à un facteur de classification

L'ANOVA à mesures répétées est utilisée lorsque les mêmes sujets sont mesurés plusieurs fois dans différentes conditions ou à différents moments. Pour effectuer l'ANOVA à mesures répétées, nous allons utiliser la fonction `anova_test()` du package `rstatix`. Dans ce chapitre, nous allons traiter de l'ANOVA à mesures répétées avec un et deux facteurs de classification. Nous présentons en détails la question du format, du traitement et de la description des donnés pour l'ANOVA à un facteur de classification. Les mêmes démarches sont à suivre pour l'ANOVA à deux facteurs pour laquelle nous présentons uniquement la marche à suivre de l'ANOVA en tant que telle et son interprétation.

### Format, traitement et description des données

Afin d'utiliser cette fonction, les données doivent être au format long, à savoir le format dans lequel chaque ligne représente une mesure individuelle avec une colonne identifiant le sujet. La base de données avec laquelle nous travaillons contient trois variables, à savoir `participants` qui correspond à la variable permettant d'identifier les sujets de l'étude, la variable `condition` qui correspond aux temps de mesure, et la variable `score` qui est la variable indépendante mesurée. La variable `condition` est donc la variable inta-sujet et la variable `score` la mesure répétée. Dans le traitement des données, il est important de contrôler que la variable des sujets et la variable intra-sujet soient des facteurs, et que la variable à mesures répétées soit numérique. Si ce n'est pas le cas, il est important de les transformer. La fonction `unique()` permet d'extraire les éléments uniques afin de savoir combien de participants sont présents dans la base de données ou combien de temps de mesure il y a.

```{r echo=TRUE}

library(dplyr) #manipulation des données
library(rstatix)

data <- read.csv("score.csv", header = TRUE, sep = ";", dec = ",")
str(data)

data$participants <- as.factor(data$participants)
data$condition <- as.factor(data$condition)
str(data)

unique(data$participants)
unique(data$condition)
```

### Effectuer et interpréter l'ANOVA

L'ANOVA s'effectue grâce à la fonction `anova_test()` en utilisant les arguments suivants:

1.  **dv**: variable dépendante numérique
2.  **within**: variable intra-sujet sous forme de facteur
3.  **wid**: variable sous forme de facteur permettant d'identifier les sujets

Afin de pouvoir interpréter une ANOVA, des hypothèses doivent être vérifiées. Il s'agit de l'hypothèse de normalité des données, que l'on teste grâce à la fonction `shapiro_test()` avant d'effectuer l'ANOVA, et l'hypothèse de sphérécité des données, que l'on contrôle directement dans le résultat de l'ANOVA.

L'hypothèse nulle du test de la normalité des données est que les données suivent une loi normale. Si cette hypothèse n'est pas rejetée, alors l'ANOVA à mesures répétées peut être effectuée. L'hypothèse nulle du test de sphérécité considère l'égalité des variances des différences des groupes. Si l'hypothèse nulle n'est pas rejetée, alors aucune correction est nécessaire. Au contraire, une correction doit s'appliquer.

La fonction `get_anova_table()` permet d'obtenir le résultat de l'ANOVA. Nous proposons d'utiliser l'argument `correction = "auto"` car il permet d'effectuer la correction nécessaire si l'hypothèse de sphérécité des données est rejetée.

```{r echo=TRUE}

data %>%
  group_by(condition) %>%
  shapiro_test(score)

res <- anova_test(data, dv = score, within = condition, wid = participants)

print(res$`Mauchly's Test for Sphericity`)

res %>% get_anova_table()
res %>% get_anova_table(correction = "auto")

```

Enfin d'interpréter le résultat de l'ANOVA, il est nécessaire d'analyser la table de l'ANOVA:

1.  **Effet**: la variable intra-sujet
2.  **DFn**: degrés de liberté du facteur intra-sujet
3.  **DFd**: degrés de liberté de l'erreur intra-sujet
4.  **F**: statistique F de Fisher
5.  **p**: significativité du test
6.  **ges**: taille de l'effet généralisée aussi appelée êta carré

La significativité du test permet de conclure sur la présence ou l'absence d'un effet significatif de la condition sur le score, donc de l'impact des temps de mesure sur le score. La taille d'effet permet d'évaluer l'importance de l'effet. Elle doit être analysée selon la grille d'analyse correspondante.

### Test post-hoc

Si l'ANOVA est significative, il est important d'effectuer un test post-hoc pour savoir quelles conditions diffèrent. Le test post-hoc est effectué avec la fonction `pairwise_t_test()` pour comparer les données pair à pair avec une correction de Bonferroni. L'interprétation se fait comme dans le cas d'un test de Student à mesures répétées.

```{r echo=TRUE}

pairwise_t_test(data, score ~ condition, paired = TRUE, p.adjust.method = "bonferroni")

```

## ANOVA à mesures répétées à deux facteurs de classification

### Données

Les mêmes manipulations préalables que pour l'ANOVA à mesures répétées avec un facteur de classification sont à effectuer. La base de données avec laquelle on travaille contient des scores répétés à trois reprises pour dix individus qui sont répartis dans deux groupes, soit expérimental, soit contrôle.

```{r echo=TRUE}

data <- read.csv("diet.csv")

str(data)

data <- data %>%
  mutate(id = as.factor(id),
         treatment = as.factor(treatment),
         time = as.factor(time), 
         score = as.numeric(score))

str(data)

unique(data$id)
unique(data$time)
unique(data$treatment)

```

### ANOVA

La présence de deux facteurs de classification change l'argument `within` de la fonction `anova_test()`. En effet, il n'y a plus une mais deux variable intra-sujet. Dans le tableau de l'ANOVA à mesures répétées avec deux facteurs de classification, il y a trois effets:

1.  L'effet principal du facteur temps qui teste si les scores changent significativement entre les trois temps de mesure. L'hypothèse nulle est l'absence de différence entre les temps.
2.  L'effet principal du groupe qui test si l'appartenance à un groupe influence significativement le score. L'hypothèse nulle est l'absence de différence entre les groupes.
3.  L'interaction entre les deux facteurs intra-sujet qui teste si l'évolution des scores dans le temps diffère selon le groupe d'appartenance. L'hypothèse nulle stipule qu'il n'y a pas d'interaction entre les deux facteurs

```{r echo=TRUE}

data %>%
  group_by(time, treatment) %>%
  shapiro_test(score)

res <-  data %>%
  anova_test(dv = score, wid = id, within = c(time, treatment))

print(res$`Mauchly's Test for Sphericity`)

res %>% get_anova_table(correction = "auto")

```

Dans notre cas, on observe que les deux facteurs sont significatifs, tout comme l'interaction entre eux. Comme l'interactione est significative, il est nécessaire de poursuivre l'analyse en effectuant une ANOVA à mesures répétées à un facteur pour la première variable pour chaque niveau de la deuxième variable, puis de faire des comparaisons multiples si l'ANOVA est significative.

Si l'interaction devait ne pas être significative, il est nécessaire de faire l'analyse des effets principaux directement.
